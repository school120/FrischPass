<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
  <title>Veracross Kiosk – Frisch</title>
  <style>
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#0b1020;color:#fff}
    #kiosk-wrapper{max-width:680px;margin:0 auto;padding:24px}
    #kiosk_bar{display:flex;justify-content:space-between;gap:12px;background:#121a36;border:1px solid rgba(255,255,255,.08);padding:10px 12px;border-radius:10px;color:#cfd8ff}
    #location span{font-weight:700}
    #time span{font-variant-numeric:tabular-nums}
    h1{font-size:22px;margin:16px 0}
    .box{background:#121a36;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:18px}
    .input-container{display:flex;align-items:center;gap:8px}
    input[type=text]{flex:1;padding:14px;border-radius:10px;border:1px solid rgba(255,255,255,.18);background:#0f1530;color:#fff;font-size:18px}
    #sign_in_button input[type=submit]{width:100%;margin-top:14px;padding:14px 16px;border-radius:10px;border:none;background:#91011c;color:#fff;font-weight:700;font-size:18px;cursor:pointer}
    #kiosk-notes{color:#9fb0d0;font-size:14px;margin-top:12px}
    #checkin_response{min-height:22px;color:#9fe0ad}
    .muted{color:#9fb0d0}
  </style>
</head>
<body>

<div id="kiosk-wrapper">
  <div id="kiosk_bar">
    <div id="location">Location:&nbsp;<span>Sign Out Main Office</span></div>
    <div id="time">Time:&nbsp;<span id="clock"></span></div>
  </div>

  <form id="checkin" action="https://checkin.veracross.com/frisch/kiosk/soutoffice" method="post">
    <!-- Hidden fields you may map if your endpoint expects them -->
    <input type="hidden" name="kiosk_type" value="5" />
    <input type="hidden" name="check_in_method" value="3" />
    <input type="hidden" name="kiosk" value="9" />

    <div class="box">
      <div id="checkin_response" class="muted"></div>
      <h1>Sign Out Main Office</h1>
      <div class="input-container">
        <input type="text" name="legacy_student_id" id="legacy_id" placeholder="School Student ID" autocomplete="off" />
      </div>
      <div id="roster_status" class="muted" style="margin-top:8px"></div>
    </div>

    <div id="sign_in_button">
      <input type="submit" value="Sign Out" />
    </div>
  </form>

  <div id="kiosk-notes">
    <span>Instructions:</span>
    <p>Tap card / scan barcode and press Enter. This page will post directly to Veracross and show their notice.</p>
  </div>
</div>

<script>
  // Simple clock
  const clock=()=>{document.getElementById('clock').textContent=new Date().toLocaleString()};
  clock(); setInterval(clock,1000);

  // === ROSTER LOADING (very simple) ===
  // Put a CSV named "roster.csv" in the same folder as this index.html (GitHub Pages will serve it).
  // Columns required: Person ID, Full Name, Legacy Student ID, Current Grade
  const roster = new Map();
  async function loadRoster(){
    try{
      const res = await fetch('roster.csv', {cache:'no-store'});
      if(!res.ok) throw new Error('No roster.csv found');
      const text = await res.text();
      const lines = text.split(/\r?\n/).filter(Boolean);
      const header = lines.shift().split(',').map(h=>h.trim().toLowerCase());
      const idxLegacy = header.indexOf('legacy student id');
      const idxName = header.indexOf('full name');
      const idxGrade = header.indexOf('current grade');
      if(idxLegacy===-1||idxName===-1){ throw new Error('Missing required headers'); }
      for(const line of lines){
        const cols = line.split(',');
        const legacy = (cols[idxLegacy]||'').trim();
        const name = (cols[idxName]||'').trim();
        const grade = (cols[idxGrade]||'').trim();
        if(legacy) roster.set(legacy, {name,grade});
      }
      document.getElementById('roster_status').textContent = `Roster loaded: ${roster.size} students.`;
    }catch(e){
      document.getElementById('roster_status').textContent = 'Roster not loaded. Place a roster.csv next to this file.';
    }
  }
  loadRoster();

  // Autofill name/grade (optional) when scanning
  const idInput = document.getElementById('legacy_id');
  idInput.addEventListener('input', ()=>{
    const hit = roster.get(idInput.value.trim());
    document.getElementById('checkin_response').textContent = hit? `${hit.name} • ${hit.grade}` : '';
  });

  // On submit: the browser navigates to Veracross and shows their notice.
  // (No AJAX; keeps it simple and ensures their success page appears.)

  // Focus field for scanners
  window.addEventListener('load', ()=> idInput.focus());
</script>
</body>
</html>
