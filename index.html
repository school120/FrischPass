<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Frisch Kiosk</title>
<meta name="theme-color" content="#111111">
<style>
:root{--fg:#0b0b0b;--bg:#fff;--muted:#6b7280;--line:#e5e7eb;}
*{box-sizing:border-box;}
html,body{height:100%;margin:0;color:var(--fg);background:var(--bg);font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;}
.hidden{display:none!important;}
.card{width:min(520px,92vw);margin:10vh auto;padding:20px 18px;border:1px solid var(--line);border-radius:14px;box-shadow:0 1px 4px rgba(0,0,0,.04);text-align:center;}
input{width:100%;padding:12px 14px;border:1px solid var(--line);border-radius:12px;font:16px system-ui;}
button{width:100%;margin-top:10px;padding:12px 16px;border:1px solid #111;background:#111;color:#fff;border-radius:12px;font-weight:800;cursor:pointer;}
.hint{color:var(--muted);font-size:12px;margin-top:.5rem}
iframe{width:100%;height:70vh;border:0;margin-top:1rem}
@page{size:62mm 100mm;margin:0;}
@media print{
  body>*:not(#print-root):not(#print-root *){display:none!important;}
}
.label{position:relative;width:62mm;height:100mm;margin:0;padding:6mm 4mm;overflow:hidden;background:#fff;}
.wm{position:absolute;inset:0;background:url('./logo.png') center/contain no-repeat;opacity:.12;filter:grayscale(100%);}
.block{position:relative;display:flex;flex-direction:column;gap:2mm;margin-top:18mm;margin-left:2mm;}
.name{font:900 22pt/1.1 system-ui;}
.sub{font:600 12pt/1.1 system-ui;}
.foot{position:absolute;left:4mm;right:4mm;bottom:4mm;font:500 9pt system-ui;}
</style>
</head>
<body>
<div id="start" class="card">
  <h1>The Frisch School</h1>
  <p><strong>Visitor / Student Check-In</strong></p>
  <label>Legacy ID</label>
  <input id="legacy" inputmode="numeric" placeholder="e.g. 123456" autofocus>
  <button id="go">Begin Check-In</button>
  <p class="hint">This will open Veracross; once it confirms, printing happens automatically.</p>
</div>

<iframe id="vc" class="hidden"></iframe>

<div id="print-root" class="label hidden">
  <div class="wm"></div>
  <div class="block">
    <div id="nm" class="name"></div>
    <div id="sb" class="sub"></div>
  </div>
  <div id="ft" class="foot"></div>
</div>

<script>
const VC_URL = "https://checkin.veracross.com/frisch/kiosk/soutoffice";
const iframe = document.getElementById("vc");
const start = document.getElementById("start");
const label = document.getElementById("print-root");

document.getElementById("go").addEventListener("click", () => {
  const id = document.getElementById("legacy").value.trim();
  if(!id){alert("Enter Legacy ID");return;}
  start.classList.add("hidden");
  iframe.classList.remove("hidden");
  iframe.src = `${VC_URL}?legacy_id=${encodeURIComponent(id)}`;
  watchVC(id);
});

function watchVC(id){
  const interval = setInterval(()=>{
    try{
      const doc = iframe.contentDocument || iframe.contentWindow.document;
      const success = doc.querySelector(".checkin-success,[data-kiosk-success='1'],.ticket-ready");
      if(success){
        clearInterval(interval);
        printLabel(id);
      }
    }catch(e){}
  }, 1000);
}

function printLabel(id){
  iframe.classList.add("hidden");
  label.classList.remove("hidden");
  document.getElementById("nm").textContent = "ID: " + id;
  document.getElementById("sb").textContent = "Visitor";
  document.getElementById("ft").textContent = new Date().toLocaleDateString() + " â€¢ The Frisch School";
  setTimeout(()=>window.print(),200);
}
</script>
</body>
</html>
