<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Frisch Kiosk – Print Label</title>
<meta name="theme-color" content="#111111" />
<style>
:root{--fg:#0b0b0b;--bg:#fff;--muted:#6b7280;--line:#e5e7eb;}
*{box-sizing:border-box}
html,body{height:100%;margin:0;color:var(--fg);background:var(--bg);font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
.hidden{display:none!important}

/* Card UI */
.card{width:min(520px,92vw);margin:12vh auto;padding:20px 18px;border:1px solid var(--line);border-radius:14px;box-shadow:0 1px 4px rgba(0,0,0,.04);text-align:center;background:#fff}
h1{margin:.25rem 0 0;font:800 20px/1.1 system-ui}
p.muted{color:var(--muted)}
label{display:block;text-align:left;font-weight:700;margin:.5rem 0 .35rem}
input{width:100%;padding:12px 14px;border:1px solid var(--line);border-radius:12px;font:16px system-ui}
button{width:100%;margin-top:10px;padding:12px 16px;border:1px solid #111;background:#111;color:#fff;border-radius:12px;font-weight:800;cursor:pointer}

/* Print label: left layout + logo contain watermark (62×100 mm DK-2205) */
@page{size:62mm 100mm;margin:0}
@media print{ body>*:not(#print-root):not(#print-root *){display:none!important} }
#print-root{position:relative;width:62mm;height:100mm;margin:0;padding:6mm 4mm;overflow:hidden;background:#fff}
#print-root.left{display:flex;flex-direction:column;justify-content:flex-start;align-items:flex-start}
#print-root .wm{position:absolute;inset:0;background:url('./logo.png') center/contain no-repeat;opacity:.12;filter:grayscale(100%);pointer-events:none}
#print-root .block{position:relative;display:flex;flex-direction:column;gap:2mm;margin-top:18mm;margin-left:2mm}
#print-root .name{font:900 22pt/1.1 system-ui,Segoe UI,Roboto}
#print-root .sub{font:600 12pt/1.1 system-ui,Segoe UI,Roboto}
#print-root .foot{position:absolute;left:4mm;right:4mm;bottom:4mm;font:500 9pt system-ui,Segoe UI,Roboto}
</style>
</head>
<body>

<!-- Input card (used when there’s no ?id= in the URL) -->
<section id="card" class="card">
  <h1>The Frisch School</h1>
  <p class="muted">Print a visitor/student label from a Legacy ID.</p>
  <label>Legacy ID</label>
  <input id="legacy" inputmode="numeric" placeholder="e.g. 123456" autofocus />
  <button id="printBtn">Print label</button>
  <p class="muted" style="margin-top:.75rem">Tip: open this page as <code>?id=123456</code> to auto-print.</p>
</section>

<!-- Label to print -->
<div id="print-root" class="left hidden" aria-label="Visitor label">
  <div class="wm"></div>
  <div class="block">
    <div id="nm" class="name"></div>
    <div id="sb" class="sub"></div>
  </div>
  <div id="ft" class="foot"></div>
</div>

<script>
const $ = s => document.querySelector(s);
function showCard(show){ $('#card').classList.toggle('hidden', !show); }
function showLabel(show){ $('#print-root').classList.toggle('hidden', !show); }

function renderLabel({ id, name, role, note }){
  // For this simple flow, we only have Legacy ID. Use it as the main line.
  $('#nm').textContent = name || (id ? `ID: ${id}` : 'Guest');
  $('#sb').textContent = role ? (note ? `${role} — ${note}` : role) : 'Visitor';
  $('#ft').textContent = new Date().toLocaleDateString() + ' • The Frisch School';
}

function printNow(payload){
  renderLabel(payload);
  showCard(false);
  showLabel(true);
  setTimeout(() => window.print(), 150);
}

function fromQuery(){
  const q = new URLSearchParams(location.search);
  return {
    id:   (q.get('id')||'').trim(),
    name: (q.get('name')||'').trim(),   // optional if you ever pass it
    role: (q.get('role')||'').trim(),   // optional
    note: (q.get('note')||'').trim()    // optional
  };
}

document.getElementById('printBtn').addEventListener('click', () => {
  const id = $('#legacy').value.trim();
  if(!id){ alert('Please enter a Legacy ID'); return; }
  // simplest: just print immediately using ID as the name line
  printNow({ id });
});

// Auto-print when opened as ?id=123 or with optional &name=&role=&note=
(function(){
  const payload = fromQuery();
  if (payload.id){
    printNow(payload);
  } else {
    showCard(true);
  }
})();
</script>
</body>
</html>
